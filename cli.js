#!/usr/bin/env node
'use strict';
var meow = require('meow')
  , linkReplacer = require('./index.js')
  ;

var cli = meow({
	help: [
		'Usage',
		'  $ markdown-plain-link-replacer "<markdown>"',
		'',
		'Example',
		'  $ markdown-plain-link-replacer "  http://starwars.wikia.com/wiki/Bespin  "'
	]
});

var input = cli.input[0];
var debugMode = cli.flags.d;

input = "Here&#39;s a better capture of the context from &quot;The Best of Both Worlds Pt I&quot;.  In the capture, Riker is presenting the quarters to Shelby for the first time.\r\n\r\n&gt; PICARD: Number One, why don&#39;t you show the Commander to her quarters?\r\n\r\n&gt; [...much unrelated conversation between Picard and Adm. Hanson about Shelby and Riker...]\r\n\r\n&gt; [![Shelby&#39;s quarters][1]][1]\r\n\r\n&gt; **[Shelby&#39;s quarters]**\r\n\r\n&gt; SHELBY: I don&#39;t know exactly what I&#39;m looking for, but we&#39;ve tested the sections of the Enterprise&#39;s hull that were damaged by the Borg. There were some unusual magnetic resonance traces.   &lt;sup&gt;**See footnote \\[1\\]**&lt;/sup&gt;\r\n\r\n**\\[1\\]**: The reason I&#39;m including this context is not because it&#39;s in question whether this is Shelby&#39;s quarters.   It&#39;s just that unlike the capture of the Asters&#39; quarters, if I take a capture later in time, it&#39;s just Riker and Shelby standing in *someone&#39;s* quarters.   I would have liked a capture of Shelby answering the door, but this isn&#39;t what happened.   To get the best capture, I&#39;m using this one of Riker introducing the quarters, and including enough script context to understand what this capture is.\r\n\r\n\r\n[![enter image description here][2]][2]\r\n\r\nThis is by [Rick Sternbach](https://en.wikipedia.org/wiki/Rick_Sternbach) who &quot;helped define the look of the 24th century that would be used throughout The Next Generation and the series that followed it, Star Trek: Deep Space Nine and Star Trek: Voyager. Props such as the phasers, tricorders, PADDs and the communicator badge were all based on his designs.&quot;\r\n\r\n[This site](http://www.ex-astris-scientia.org/database/space_art_tng.htm) on Ex Astris Scientia gives the following comments from him:\r\n\r\n&gt; Another F&amp;SF cover I did for a Benford story &#39;The Anvil of Jove&#39;.&quot; \r\n\r\n&gt; &quot;Balloon-borne spacecraft in the atmosphere of Jupiter. Very Bob McCall type of sun flare. :)&quot;\r\n\r\nAnd these details (not a quote from Sternbach):\r\n\r\n&gt; Anvil of Jove can be found in the July 1976 issue of the Fantasy &amp; Science Fiction (F&amp;SF) Magazine.\r\n\r\nas well as the fact it was seen in both &quot;The Best of Both Worlds&quot; in Cmdr. Shelby&#39;s guest quarters and previously in &quot;The Bonding&quot; in Marla Aster&#39;s quarters &lt;sub&gt;(apparently the dead&#39;s effects are unceremoniously used to decorate guest quarters)&lt;/sub&gt;\r\n\r\nReference: http://www.ex-astris-scientia.org/database/space_art_tng.htm\r\nImage number 18.\r\n\r\nIncidentally, here&#39;s the capture from the Asters&#39; quarters:\r\n\r\n[![enter image description here][3]][3]\r\n\r\nTracking this down more, the work is listed [here](https://www.sfsite.com/fsf/bibliography/fsfcovartwhen07.htm), with the following info:\r\n\r\n&gt; **302** \t*1976 JUL* \t**Sternbach, Rick** \tcover illustrates &quot;The Anvil of Jove&quot; by Gregory Benford &amp; Gordon Eklund; Sternbach&#39;s 1st pub. art was in ANA 1973 OCT; he W-1977-1978 HUG, &amp; N-1975-1976, for Best Professional Artist; also did F&amp;SF covers as Richard Sternbach\r\n\r\nThis image of the cover can be found [here](http://www.philsp.com/mags/fsf.html), which gives all the covers of *Fantasy &amp; Science Fiction* magazine:   (It&#39;s v51 \\#1\r\n\\#302.) \r\n\r\n[![enter image description here][4]][4]\r\n\r\nThe image of the original painting (visible in *TNG*) appears to have has its left side (and a sliver on the right) cropped to fit the aspect ratio of the magazine cover 13 years earlier.   Side by side:\r\n\r\n\r\n[![enter image description here][5]][5][![enter image description here][6]][6]\r\n\r\n\r\nI can&#39;t find detailed enough info on &quot;The Anvil of Jove&quot; to determine the degree to which this painting directly represents something in the novella.\r\n\r\n[**EDIT:**  *I have ordered a copy of the magazine so I can read &quot;The Anvil of Jove&quot; and update.   Stay tuned.*]\r\n\r\n**EDIT:   It&#39;s finally here after the USPS did everything possible to prevent it   Stand by...**\r\n\r\n[![enter image description here][7]][7]\r\n[![enter image description here][8]][8]\r\n[![enter image description here][9]][9]\r\n\r\n\r\nWhile I&#39;m working on an improved answer based on the content of the novella, why not sit back and enjoy a smoke suggested by the lovely [color plate](http://english.stackexchange.com/questions/291592/whats-the-name-of-the-color-printed-section-in-a-book/291596#291596) in this publication:\r\n\r\n[![enter image description here][10]][10]\r\n[![enter image description here][11]][11]\r\n\r\n\r\n\r\n\r\n-------\r\nOK, I&#39;ve finally finished the novella and found enough time to write about it.\r\n\r\n*The Anvil of Jove* by Gregory Benford and Gordon Eklund is a remarkably complex and well-written novella for its scant 64 pages.   (Everything which follows is spoilers -- but given that there is probably not another single person in the world who is going to read this novella after reading this description, I&#39;ll dispense with the spoiler blocks)\r\n\r\nThe story takes place in the relatively near future (presumably 21st or 22nd century) primarily on and around the Orb -- \r\n\r\n&gt; that was a stupid name.  It wasn&#39;t a sphere, it was a tin can, a lazy spinning cylinder.  A few hundred meters above  ... was the pancake of storage water which blocked the sleeting high-energy protons for the Van Allen belt.  Orb came from orbit. &lt;sub&gt;pg 64&lt;/sub&gt;\r\n\r\nThe Orb orbits Jupiter and is inhabited by five hundred highly specialized and competent scientists and specialists, &quot;a spinning can of prima donnas&quot;&lt;sub&gt;pg 100&lt;/sub&gt;\r\n\r\nWhen the action opens, we find the protagonist, Mara, 26, on an unsanctioned spacewalk looking down on the Great Red Spot and other identifiable features of Jupiter because she needed to see it directly.\r\n\r\nHowever, as she attempts to re-enter, her umbilical fails and she is saved only by her own quick action.   After she&#39;s back aboard, we meet the leader of the expedition, Bradley Reynolds, who is a 127-year-old, who &quot;had married five times, known countless lovers, acquired many friends and at least three \r\nprofessions&quot; &lt;sub&gt;pg 66&lt;/sub&gt;.   He had been to the moon and Mars, and was &quot;a legend alive, a creature from another time, a spaceman&quot; &lt;sub&gt; pg 67&lt;/sub&gt;.   He had been in retirement at a Tunisian monastery when he was sought out for the mission.\r\n\r\nThe mission is the result of a reverse SETI scenario, wherein the following image was decoded (based on being a product of two primes in length)\r\n[![enter image description here][12]][12]\r\nThey have interpreted it as meaning it originated at a Jupiter-like gas giant (the large blob after the smaller three terrestrial blobs, which is bolstered by some astrophysical and Doppler evidence.   However, they cannot interpret the left portion of the image.   This is known as The Puzzle, and was the impetus for sending the mission to Jupiter:  learn as much about Jupiter (or its moons) as possible to help understand the alien communication.\r\n\r\nNow, we learn that Mara is a manip (or Nippy), meaning that she was genetically manipulated and is far beyond the capabilities of the others.   The manips (counting in the thousands) are not a popular bunch.   Reynolds, despite being something of a Renaissance man vis-a-vis religion is on good terms with Mara.   However there is a very significant contingent on Earth (and on the Orb) who feel they are an abomination.   It is presumed that one of the &quot;Christers&quot; on Orb was responsible for the sabotage.  \r\n\r\nNow, in addition to Mara, there is Corey, a different form of manip, who is a bodiless brain encased in a metal box on wheels.   Corey is genderless and lacks clear sense of self.  This is evidenced by the portions which are narrated from Corey&#39;s point of view, wherein Corey can&#39;t settle on using the first or the third person or which gender pronoun to use for him/herself.   Corey is on-board because of significant experience communicating with dolphins as well as being as intellectually able as Mara.   They are close friends on a purely intellectual level.\r\n\r\nNext, news comes in.   Reynolds states\r\n\r\n&gt; Mara, this is serious.  Genetic experimentation  has been forbidden.   There&#39;s some sort of religious revival occurring on Earth &lt;sub&gt;pg 83&lt;/sub&gt; \r\n\r\nand Mara explains to Corey \r\n\r\n&gt; We&#39;ve been stripped of our human rights, Corey, deprived of citizenship.  Earth has finally decided that a superman isn&#39;t really a man.   We&#39;re state property now.  They made us, they own us. &lt;sub&gt; pg 82&lt;/sub&gt;\r\n\r\nThere is some discussion that the manips have control of all the weapons on Earth and have threatened to destroy Tokyo if their rights are not upheld.   This all seems far from the Orb, but Mara and Corey are confined to quarters.   Mara resolves to re-double her efforts to solve the Puzzle and intends to use the solution as leverage to help her kind.\r\n\r\nShe again needs to go see Jupiter, this time in a shuttle, and again she&#39;s the victim of sabotage, which she narrowly survives.\r\n\r\nThey determine that Corey should proceed on his glideship *Aurora* to descend toward Jupiter.  (This has always been the plan.)\r\n\r\n&gt; The descent into the atmosphere was necessary; everyone has known that for some time.  Automatic guidance systems were inadequate to the supersonic raging winds of Jovian belts.   Direction form the Orb by radio link was impossible; the time delay would make the craft hopelessly sluggish.   And Corey wanted to go, sought the sacrifice, whereas no human aboard the Orb did.&#182; And perhaps it was best for that metal man to go now, into the deep ocean of gas.&lt;sub&gt;pg 100&lt;/sub&gt;\r\n\r\nNew news comes in, that a great many of the manips on Earth have been eliminated by surprise assassination.  Tokyo has not been destroyed, and it appears the unaltered humans are safely in control.   However Reynolds has been ordered to kill Mara (and Corey).   Reynolds won&#39;t follow through, and it&#39;s clear that his elected command of the Orb won&#39;t last much longer.\r\n\r\nShortly thereafter, Mara boards a shuttle so she can work on the Puzzle undisturbed and unmurdered.\r\n\r\nCorey begins his descent.   There is extensive description of the process and the various layers passed through of the Jovian atmosphere.\r\n\r\n&gt; The heat shield flares red and Corey orders it to die.   The cinders fall behind.   Automatic sequencing beings [sic, *s/b begins*?].   With a pop that strums through my [Corey&#39;s] circuits I feel the tug and shift as the first drogue parachute deploys.  I fall more slowly.  Telemetry from Orb confirms I am through the pure hydrogen sheath, and now opticals see the pearly ammonia cirrus rushing up from below.   The infinite enveloping blanket accepts me.  Through the Ingersoll layer, where idiot probes have gone before me.   Navigating, I twist.   I slide.  &lt;sub&gt;pg 108&lt;/sub&gt;\r\n\r\nAnd then, finally, we get to the part depicted in the image:\r\n\r\n&gt; I Doppler on the rising heat formation and jet leftward, correcting, correcting.  **Above *Aurora* float the hot hydrogen balloon** that keeps us buoyant, fed by the fusion percolator.  [...]\r\n\r\n&gt; Corey bids itself to fall.   The fusion reactor mutes, the balloon above me cools, and I drift steadily down.  [...]\r\n\r\n&gt; Corey eases the purring of his fusion engine.   He spills a bit of hot hydrogen gas from the balloon above him, and the gondola begins to sink.  [...]\r\n\r\n&gt; A gust blows Corey to the side and the **gondola cables** wrench fiercely shuddering &lt;sub&gt;pg 110-111&lt;/sub&gt;\r\n\r\nEventually, Corey descends through enough layers and happens upon giant 500-m balls.   They come to react to his transmissions, so they determine they are alive.  Eventually, Mara and the others come to realize that the creatures are spherical due to the high pressure and live in an environment that is more three-dimensional than the surface humans are confined to.   These two things lead Mara to the assertion that for such a creature, angles are a more fundamental mathematical concept than numbers:\r\n\r\n&gt; we measure the angles in a triangle one way and we count apples another.   Using one and two and three and so on seems natural to us, and angular coordinates -- degrees, radians -- aren&#39;t.  But the Alpha Libra signals may have it the other way around, though.   They live in a universe of clouds, with no straight lines anywhere.   So they sent the first part of their message in simple-minded notations, but then switched to &#39;natural&#39; ways to talking when they got down to serious business.\r\n\r\nThis insight allows them to find a transformation that can make sense of the Puzzle.  The message contains a bunch of mathematical theorems that seem to be building up to what humans find to be basic concepts.\r\n\r\nFinally, Corey radios that he was the saboteur.  He wants to die at the same time as Mara because he has realized he is both male and in love with her, yet she sees him as a metal box.   To that end, he has set another trap on Mara&#39;s shuttle.   Corey&#39;s confession is too soon however, as Mara again narrowly escapes the destruction of her vehicle.  \r\n\r\nMara gets back onto Orb, and it appears no one is still intent on killing her.\r\n\r\n-----\r\n\r\n**So, to summarize, the craft depicted in the painting does appears to be a fairly faithful representation directly based on the glideship *Aurora* and its hydrogen balloon, used to drop into the atmosphere of Jupiter in *The Anvil of Jove* by Gregory Benford and Gordon Eklund**\r\n\r\n-----\r\n# Related: [Where is this painting now?](http://scifi.stackexchange.com/questions/118286/where-is-this-painting-from-the-enterprise-now)\r\n\r\n\r\n\r\n\r\n  [1]: http://i.stack.imgur.com/NeoM2.jpg\r\n  [2]: http://i.stack.imgur.com/2Vl8G.jpg\r\n  [3]: http://i.stack.imgur.com/ZmpPSm.jpg\r\n  [4]: http://i.stack.imgur.com/US4eh.jpg\r\n  [5]: http://i.stack.imgur.com/2Vl8Gm.jpg\r\n  [6]: http://i.stack.imgur.com/US4ehm.jpg\r\n  [7]: http://i.stack.imgur.com/dSE6tm.jpg\r\n  [8]: http://i.stack.imgur.com/RWwsKm.jpg\r\n  [9]: http://i.stack.imgur.com/IlUvS.jpg\r\n  [10]: http://i.stack.imgur.com/YF3AHm.jpg\r\n  [11]: http://i.stack.imgur.com/3F3Ekm.jpg\r\n  [12]: http://i.stack.imgur.com/FEZ6C.jpg\r\n\r\n\r\n";
linkReplacer.replacePlainLinks(input, function(newMarkdown){
	if(cli && cli.flags && cli.flags.h){
		return;
	}
	console.log(newMarkdown);
}, cli.flags);